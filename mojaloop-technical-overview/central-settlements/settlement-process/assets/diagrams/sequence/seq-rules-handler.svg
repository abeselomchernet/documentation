<svg xmlns="http://www.w3.org/2000/svg" height="3112" preserveAspectRatio="none" style="width:2601px;height:3112px" width="2601">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="429" x="1084" y="28.708">
    Transfer Settlement Handler Consume (Success)
  </text>
  <path fill="#90EE90" stroke="#a80036" d="M26 40.953h1975.5v3065.07H26z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="944.25" y="53.02">
    Settlement Service
  </text>
  <path fill="#FFFFE0" stroke="#a80036" d="M2036 40.953h125v3065.07h-125z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="2039" y="53.02">
    Central Services
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M93 844.766h10v30H93zM373 132.383h10v2898.344h-10zM819 201.781h10V784.5h-10zM819 1082.695h10v419.727h-10zM1382 1135.961h10v288.195h-10zM1620 1165.094h10v222.93h-10zM1921.5 1677.219h10v29.133h-10zM2093.5 1194.227h10v29.133h-10zM2093.5 2112.813h10v30h-10zM2093.5 2477.469h10v30h-10zM2093.5 2631.133h10v30h-10zM2093.5 2768.797h10v30h-10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M10 139.383h2577v2884.344H10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M317 163.516h1080V792.5H317z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M762 216.781h625v273.461H762zM20 806.5h2557v2210.227H20z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M317 889.766h378v74.398H317zM257 978.164h2310v2031.563H257z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M317 1044.43h1853.5v465.992H317z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M762 1097.695h1398.5v376.594H762zM267 1524.422h2290v1478.305H267z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M277 1590.688h1750.5v416.594H277z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M287 1614.82h1730.5v385.461H287z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M297 1638.953h1710.5v354.328H297z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M307 1763.484h378v178.664H307z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M317 1787.617h358v103.398H317z"/>
  <path fill="#FFF" d="M317 1846.883h358v44.133H317zM307 1898.016h378v44.133H307zM297 1949.148h1710.5v44.133H297z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M317 2021.281h2230v930.313H317z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M1660 2074.547h877v825.914h-877z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M1870 2522.469h456V2603h-456z"/>
  <path fill="#FFF" d="M317 2907.461h2230v44.133H317zM267 2958.594h2290v44.133H267z"/>
  <path stroke="#a80036" stroke-dasharray="5,5" d="M98 122.383v2918.344M378 122.383v2918.344M824 122.383v2918.344M1386.5 122.383v2918.344M1625 122.383v2918.344M1786.5 122.383v2918.344M1926.5 122.383v2918.344M2098.5 122.383v2918.344"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M34 83.086h128v30.297H34z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M30 87.086h128v30.297H30z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="37" y="107.081">
    topic-notification
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M34 3039.727h128v30.297H34z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M30 3043.727h128v30.297H30z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="37" y="3063.722">
    topic-notification
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="327" y="119.081">
    Rules Handler
  </text>
  <circle cx="378" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M374 78.086l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="327" y="3052.722">
    Rules Handler
  </text>
  <circle cx="378" cy="3072.023" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M374 3060.023l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="772" y="119.081">
    Scripts Loader
  </text>
  <circle cx="824" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M812 104.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="772" y="3052.722">
    Scripts Loader
  </text>
  <circle cx="824" cy="3072.023" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M812 3086.023h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="1338.5" y="119.081">
    Script Engine
  </text>
  <circle cx="1387" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1375 104.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="1338.5" y="3052.722">
    Script Engine
  </text>
  <circle cx="1387" cy="3072.023" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1375 3086.023h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1564" y="119.081">
    Transaction DAO
  </text>
  <circle cx="1625" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1613 104.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1564" y="3052.722">
    Transaction DAO
  </text>
  <circle cx="1625" cy="3072.023" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1613 3086.023h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1728.5" y="119.081">
    Settlement DAO
  </text>
  <circle cx="1787" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1775 104.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1728.5" y="3052.722">
    Settlement DAO
  </text>
  <circle cx="1787" cy="3072.023" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1775 3086.023h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="136" x="1855.5" y="119.081">
    Central Ledger DAO
  </text>
  <circle cx="1926.5" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1914.5 104.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="136" x="1855.5" y="3052.722">
    Central Ledger DAO
  </text>
  <circle cx="1926.5" cy="3072.023" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1914.5 3086.023h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="2046.5" y="119.081">
    central_ledger
  </text>
  <path d="M2080.5 70.086c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M2080.5 70.086c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="2046.5" y="3052.722">
    central_ledger
  </text>
  <path d="M2080.5 3066.023c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M2080.5 3066.023c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M93 844.766h10v30H93zM373 132.383h10v2898.344h-10zM819 201.781h10V784.5h-10zM819 1082.695h10v419.727h-10zM1382 1135.961h10v288.195h-10zM1620 1165.094h10v222.93h-10zM1921.5 1677.219h10v29.133h-10zM2093.5 1194.227h10v29.133h-10zM2093.5 2112.813h10v30h-10zM2093.5 2477.469h10v30h-10zM2093.5 2631.133h10v30h-10zM2093.5 2768.797h10v30h-10z"/>
  <path d="M10 139.383h404v7l-10 10H10v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M10 139.383h2577v2884.344H10z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="359" x="25" y="152.45">
    Transfer Settlement Handler Consume (Success)
  </text>
  <path d="M317 163.516h137v7l-10 10H317v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M317 163.516h1080V792.5H317z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="332" y="176.583">
    Load Scripts
  </text>
  <path fill="#A80036" stroke="#a80036" d="M807 197.781l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M383 201.781h430"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="390" y="196.715">
    1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="403" y="196.715">
    load scripts (scriptDirectory)
  </text>
  <path d="M762 216.781h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M762 216.781h625v273.461H762z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="777" y="229.848">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="854" y="228.992">
    [script]
  </text>
  <path stroke="#a80036" d="M829 255.047h42M871 255.047v13M830 268.047h41"/>
  <path fill="#A80036" stroke="#a80036" d="M840 264.047l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="836" y="249.981">
    2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="849" y="249.981">
    retrieve script configuration
  </text>
  <path stroke="#a80036" d="M829 297.18h42M871 297.18v13M830 310.18h41"/>
  <path fill="#A80036" stroke="#a80036" d="M840 306.18l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="836" y="292.114">
    3
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="526" x="849" y="292.114">
    validate script headers are valid and combination of type, action, status is allowed;
  </text>
  <path d="M834 323.18v115h138v-105l-10-10H834" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M962 323.18v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="840" y="340.247">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="852" y="355.379">
    notification: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="864" y="370.512">
    commit: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="872" y="385.645">
    success: true
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="864" y="400.778">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="852" y="415.911">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="840" y="431.043">
    }
  </text>
  <path stroke="#a80036" d="M829 469.242h42M871 469.242v13M830 482.242h41"/>
  <path fill="#A80036" stroke="#a80036" d="M840 478.242l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="836" y="464.176">
    4
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="849" y="464.176">
    Execute script with sample transfer to see all required ledger fields are filled?
  </text>
  <path d="M388 502.242v252h361v-242l-10-10H388" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M739 502.242v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="394" y="519.309">
    example:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="394" y="534.442">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="410" y="549.575">
    scriptType: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="426" y="564.707">
    scriptAction: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="442" y="579.84">
    scriptStatus: {[
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="458" y="594.973">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="474" y="610.106">
    filename: &quot;interchangeFeeCalculation.js&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="474" y="625.239">
    startTime: &quot;2020-06-01T00:00:00.000Z&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="474" y="640.372">
    endTime: &quot;2100-12-31T23:59:59.999Z&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="474" y="655.504">
    script: [vm.Script],
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="474" y="670.637">
    failPolicy: &apos;oneFailsAll&apos; // insertOnlyValid
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="458" y="685.77">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="442" y="700.903">
    ]}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="426" y="716.036">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="410" y="731.168">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="394" y="746.301">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M394 780.5l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M388 784.5h435"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="400" y="779.434">
    5
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="413" y="779.434">
    script map
  </text>
  <path d="M20 806.5h224v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 806.5h2557v2210.227H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="35" y="819.567">
    Process Single Message
  </text>
  <path fill="#A80036" stroke="#a80036" d="M114 840.766l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" d="M108 844.766h264"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="120" y="839.7">
    6
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="133" y="839.7">
    Consume notification event message
  </text>
  <path d="M317 889.766h177v7l-10 10H317v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M317 889.766h378v74.398H317z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="332" y="902.832">
    Validate Message
  </text>
  <path stroke="#a80036" d="M383 943.164h42M425 943.164v13M384 956.164h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 952.164l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="390" y="930.532">
    7
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="403" y="922.965">
    Validate event - Rule: message has payload
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403" y="938.098">
    Error codes:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497" y="938.098">
    2001
  </text>
  <path d="M257 978.164h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M257 978.164h2310v2031.563H257z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="272" y="991.231">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="336" y="990.375">
    [Rule found]
  </text>
  <path stroke="#a80036" d="M383 1016.43h42M425 1016.43v13M384 1029.43h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 1025.43l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="390" y="1011.364">
    8
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="409" x="403" y="1011.364">
    check if ScriptMap[type][action][result] has valid script assigned
  </text>
  <path d="M317 1044.43h159v7l-10 10H317v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M317 1044.43h1853.5v465.992H317z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="332" y="1057.497">
    Execute Scripts
  </text>
  <path fill="#A80036" stroke="#a80036" d="M807 1078.695l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M383 1082.695h430"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="390" y="1077.629">
    9
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="403" y="1077.629">
    execute scripts
  </text>
  <path d="M762 1097.695h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M762 1097.695h1398.5v376.594H762z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="777" y="1110.762">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="854" y="1109.906">
    [script]
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1370 1131.96l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M829 1135.961h547"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="836" y="1130.895">
    10
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="858" y="1130.895">
    execute(script, message payload)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1608 1161.094l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1392 1165.094h222"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1399" y="1160.028">
    11
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="1421" y="1160.028">
    Get transaction by transfer Id
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2081.5 1190.227l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1630 1194.227h457.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1637" y="1189.161">
    12
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="1659" y="1189.161">
    retrieve ILP packet from ilpPacket
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1641 1219.36l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M1635 1223.359h462.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1647" y="1218.293">
    13
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1669" y="1218.293">
    ilpPacket row
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1403 1248.492l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M1397 1252.492h222"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1409" y="1247.426">
    14
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1431" y="1247.426">
    ilpPacket row
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1608 1277.625l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1392 1281.625h222"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1399" y="1276.559">
    15
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1421" y="1276.559">
    Get transaction object
  </text>
  <path stroke="#a80036" d="M1630 1310.758h42M1672 1310.758v13M1631 1323.758h41"/>
  <path fill="#A80036" stroke="#a80036" d="M1641 1319.758l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1637" y="1305.692">
    16
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1659" y="1305.692">
    decode ILP packet
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1403 1348.89l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M1397 1352.891h222"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1409" y="1347.825">
    17
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="1431" y="1347.825">
    Transaction object
  </text>
  <path stroke="#a80036" d="M1392 1387.023h42M1434 1387.023v13M1387 1400.023h47"/>
  <path fill="#A80036" stroke="#a80036" d="M1397 1396.023l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1399" y="1381.957">
    18
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="1421" y="1381.957">
    execute script in sandbox
  </text>
  <path fill="#A80036" stroke="#a80036" d="M840 1420.156l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M834 1424.156h552"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="846" y="1419.09">
    19
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="868" y="1419.09">
    Ledger entries
  </text>
  <path stroke="#a80036" d="M829 1453.289h42M871 1453.289v13M830 1466.289h41"/>
  <path fill="#A80036" stroke="#a80036" d="M840 1462.29l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="836" y="1448.223">
    20
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="858" y="1448.223">
    Merge results
  </text>
  <path fill="#A80036" stroke="#a80036" d="M394 1498.422l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M388 1502.422h435"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="400" y="1497.356">
    21
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="422" y="1497.356">
    script results
  </text>
  <path d="M267 1524.422h433v7l-10 10H267v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M267 1524.422h2290v1478.305H267z"/>
  <text fill="#00F" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="388" x="282" y="1537.489">
    DB TRANSACTION: Validate and Insert ledger entries
  </text>
  <path stroke="#a80036" d="M383 1562.688h42M425 1562.688v13M384 1575.688h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 1571.688l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="1557.622">
    22
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="412" y="1557.622">
    Create validBatch = [];
  </text>
  <path d="M277 1590.688h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M277 1590.688h1750.5v416.594H277z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="292" y="1603.754">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="369" y="1602.898">
    [ledgerEntry]
  </text>
  <path d="M287 1614.82h219v7l-10 10H287v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M287 1614.82h1730.5v385.461H287z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="302" y="1627.887">
    Validate Ledger entries
  </text>
  <path d="M297 1638.953h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M297 1638.953h1710.5v354.328H297z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="312" y="1652.02">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="386" x="376" y="1651.164">
    [participant is payer and settlement model is checking NDC]
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1909.5 1673.219l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M383 1677.219h1532.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="1672.153">
    23
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="412" y="1672.153">
    participant position and limit
  </text>
  <path fill="#A80036" stroke="#a80036" d="M394 1702.352l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M388 1706.352h1537.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="400" y="1701.286">
    24
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="422" y="1701.286">
    participant position and limit
  </text>
  <path stroke="#a80036" d="M383 1735.484h42M425 1735.484v13M384 1748.484h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 1744.484l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="1730.418">
    25
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="412" y="1730.418">
    Increace position with ledgerEntry.amount
  </text>
  <path d="M307 1763.484h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M307 1763.484h378v178.664H307z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="322" y="1776.551">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249" x="386" y="1775.695">
    [Calculated position is breaching NDC]
  </text>
  <path d="M317 1787.617h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M317 1787.617h358v103.398H317z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="332" y="1800.684">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="159" x="396" y="1799.828">
    [failPolicy is oneFailsAll]
  </text>
  <path stroke="#a80036" d="M383 1825.883h42M425 1825.883v13M384 1838.883h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 1834.883l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="1820.817">
    26
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="412" y="1820.817">
    validBatch = []; break Loop ledgerEntry
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M317 1847.883h358"/>
  <path stroke="#a80036" d="M383 1870.016h42M425 1870.016v13M384 1883.016h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 1879.016l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="1864.95">
    27
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="412" y="1864.95">
    continue Loop ledgerEntry
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M307 1899.016h378"/>
  <path stroke="#a80036" d="M383 1921.148h42M425 1921.148v13M384 1934.148h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 1930.148l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="1916.082">
    28
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="412" y="1916.082">
    Insert LedgerEntry into Valid batch;
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M297 1950.148h1710.5"/>
  <path stroke="#a80036" d="M383 1972.281h42M425 1972.281v13M384 1985.281h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 1981.281l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="1967.215">
    29
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="412" y="1967.215">
    Insert LedgerEntry into Valid batch;
  </text>
  <path d="M317 2021.281h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M317 2021.281h2230v930.313H317z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="332" y="2034.348">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="396" y="2033.492">
    [validBatch has entries]
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1775 2055.547l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M383 2059.547h1398"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="2054.481">
    30
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="412" y="2054.481">
    Insert valid ledger entries
  </text>
  <path d="M1660 2074.547h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M1660 2074.547h877v825.914h-877z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="1675" y="2087.614">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="1752" y="2086.757">
    [validBatch]
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2081.5 2108.813l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1787 2112.813h300.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1794" y="2107.747">
    31
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1816" y="2107.747">
    Insert transferParticipant records
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1680 2155.813h837l10 147-10 148h-837l-10-148 10-147z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="1682" y="2171.879">
    insert into
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="1750" y="2171.879">
    transferParticipant
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1682" y="2187.012">
    select {transferId} AS transferId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="1706" y="2202.145">
    `PC`.`participantCurrencyId`,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="1706" y="2217.278">
    IFNULL(`T1`.`transferparticipantroletypeId`,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="460" x="1738" y="2232.411">
    `T2`.`transferparticipantroletypeId`) as `transferParticipantRoleTypeId`,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1706" y="2247.544">
    `E`.`ledgerEntryTypeId`,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1706" y="2262.676">
    CASE `P`.`name`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="1722" y="2277.809">
    WHEN {ledgerEntry.payerFspId} THEN {ledgerEntry.amount}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="1722" y="2292.942">
    WHEN {ledgerEntry.payeeFspId} THEN {ledgerEntry.amount * -1}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="1722" y="2308.075">
    ELSE 0
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1706" y="2323.207">
    END AS `amount`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="1682" y="2338.34">
    from `participantCurrency` as `PC`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479" x="1682" y="2353.473">
    inner join `participant` as `P` on `P`.`participantId` = `PC`.`participantId`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="630" x="1682" y="2368.606">
    inner join `ledgerEntryType` as `E` on `E`.`LedgerAccountTypeId` = `PC`.`LedgerAccountTypeId`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="833" x="1682" y="2383.739">
    left outer join `transferParticipantRoleType` as `T1` on `P`.`name` = {ledgerEntry.payerFspId} and `T1`.`name` = &apos;PAYER_DFSP&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="833" x="1682" y="2398.872">
    left outer join `transferParticipantRoleType` as `T2` on `P`.`name` = {ledgerEntry.payerFspId} and `T2`.`name` = &apos;PAYEE_DFSP&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="1682" y="2414.004">
    where `E`.`name` = {ledgerEntry.ledgerEntryTypeId}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="469" x="1690" y="2429.137">
    and `P`.`name` in ({ledgerEntry.payerFspId}, {ledgerEntry.payeeFspId})
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="1690" y="2444.27">
    and `PC`.`currencyId` = {ledgerEntry.currency};
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2081.5 2473.469l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1787 2477.469h300.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1794" y="2472.403">
    32
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="1816" y="2472.403">
    Update positions
  </text>
  <path d="M1870 2522.469h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M1870 2522.469h456V2603h-456z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="1885" y="2535.536">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="1962" y="2534.679">
    [transferParticipant records]
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1890 2544.602h416l10 26-10 27h-416l-10-27 10-26z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="1892" y="2560.669">
    update
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="1941" y="2560.669">
    `participantPosition`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="1892" y="2575.801">
    set `value` = `value` + {record.amount}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="412" x="1892" y="2590.934">
    where `participantCurrencyId` = {record.participantCurrencyId};
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2081.5 2627.133l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1787 2631.133h300.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1794" y="2626.067">
    33
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="1816" y="2626.067">
    Get transferStateChange record
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1971 2674.133h255l10 34-10 34h-255l-10-34 10-34z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="1973" y="2690.2">
    select `transferStateChangeId`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="1973" y="2705.332">
    from
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="2007" y="2705.332">
    `transferStateChange`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="1973" y="2720.465">
    where `transferId` = {transferId}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1981" y="2735.598">
    and `transferStateId` = &apos;COMMITTED&apos;;
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2081.5 2764.797l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1787 2768.797h300.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1794" y="2763.731">
    34
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1816" y="2763.731">
    Insert participantPositionChange records
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1828 2811.797h541l10 41-10 42h-541l-10-42 10-41z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="1830" y="2827.864">
    insert into
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="1898" y="2827.864">
    `participantPositionChange`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="524" x="1830" y="2842.997">
    select `participantPositionId`, {transferStateChangeId}, `value`, `reservedValue`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1830" y="2858.129">
    from `participantPosition`
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="537" x="1830" y="2873.262">
    where `participantCurrencyId` = {transferParticipantRecord1.participantCurrencyId}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="516" x="1838" y="2888.395">
    or `participantCurrencyId` = {transferParticipantRecord2.participantCurrencyId};
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M317 2908.461h2230"/>
  <path stroke="#a80036" d="M383 2930.594h42M425 2930.594v13M384 2943.594h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 2939.594l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="2925.528">
    35
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="412" y="2925.528">
    exit
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M267 2959.594h2290"/>
  <path stroke="#a80036" d="M383 2981.727h42M425 2981.727v13M384 2994.727h41"/>
  <path fill="#A80036" stroke="#a80036" d="M394 2990.727l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="390" y="2976.661">
    36
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="412" y="2976.661">
    exit
  </text>
</svg>
